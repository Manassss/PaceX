{"ast":null,"code":"var _jsxFileName = \"/Users/manas_mm/Desktop/Uni-Sphere/client/src/components/AddPost.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { TextField, Button, Container, Typography, Paper, Box } from '@mui/material';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\nimport { useAuth } from '../auth/AuthContext';\nimport { getAuth } from \"firebase/auth\";\nimport { storage } from '../firebase';\nimport { ref, uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AddPost = () => {\n  _s();\n  const [content, setContent] = useState('');\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth(); // Get user from context\n  const [postimg, setpostimg] = useState('');\n  const [selectedFile, setSelectedFile] = useState(null); // State for image upload\n  const userId = id ? id : user === null || user === void 0 ? void 0 : user._id;\n  const {\n    id\n  } = useParams();\n  const handleImageUpload = async () => {\n    if (!selectedFile) {\n      alert(\"Please select an image first!\");\n      return;\n    }\n    const storageRef = ref(storage, `postPictures/${userId}/${selectedFile.name}`);\n    const uploadTask = uploadBytesResumable(storageRef, selectedFile);\n    uploadTask.on(\"state_changed\", snapshot => {\n      console.log(`Upload progress: ${snapshot.bytesTransferred / snapshot.totalBytes * 100}%`);\n    }, error => {\n      console.error(\"Upload error:\", error);\n      alert(\"Upload failed. Check Firebase Storage permissions.\");\n    }, async () => {\n      // ✅ Get the download URL from Firebase Storage\n      const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\n      console.log(\"Downloaded URL:\", downloadURL);\n\n      // ✅ Update profileImage in MongoDB immediately after uploading\n      try {\n        // const res = await axios.put(`http://localhost:5001/api/users/profile/${userId}`, {\n        //     profileImage: downloadURL\n        // });\n\n        // setUserDetails(res.data.user); // Update UI state with new image URL\n        setpostimg(downloadURL); // Ensure form data is updated\n        alert(\"Post picture updated successfully!\");\n      } catch (err) {\n        var _err$response, _err$response$data;\n        console.error(\"Error updating profile picture:\", ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || err.message);\n      }\n    });\n  };\n  const handleFileChange = event => {\n    setSelectedFile(event.target.files[0]);\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      const postData = {\n        userId: user === null || user === void 0 ? void 0 : user._id,\n        // Safely accessing user data\n        userName: user === null || user === void 0 ? void 0 : user.name,\n        content\n      };\n      console.log('Post Data:', postData); // Log the data before sending\n\n      // Send post data to backend\n      await axios.post('http://localhost:5001/api/posts/add', postData);\n      alert('Post created successfully!');\n      navigate('/home'); // Redirect to home after posting\n    } catch (err) {\n      var _err$response2;\n      console.error('Error creating post:', ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.data) || err.message); // More detailed error logging\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"sm\",\n    sx: {\n      mt: 5\n    },\n    children: /*#__PURE__*/_jsxDEV(Paper, {\n      elevation: 3,\n      sx: {\n        p: 4,\n        borderRadius: 3\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h4\",\n        align: \"center\",\n        gutterBottom: true,\n        children: \"Create a New Post\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        component: \"form\",\n        onSubmit: handleSubmit,\n        sx: {\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 2\n        },\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          label: \"What's on your mind?\",\n          variant: \"outlined\",\n          multiline: true,\n          rows: 4,\n          value: content,\n          onChange: e => setContent(e.target.value),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          type: \"submit\",\n          children: \"Post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 9\n  }, this);\n};\n_s(AddPost, \"LxAe3d2hxXWJgSJrfzoKEyrLA8I=\", false, function () {\n  return [useNavigate, useAuth, useParams];\n});\n_c = AddPost;\nexport default AddPost;\nvar _c;\n$RefreshReg$(_c, \"AddPost\");","map":{"version":3,"names":["React","useState","axios","TextField","Button","Container","Typography","Paper","Box","Link","useNavigate","useParams","useAuth","getAuth","storage","ref","uploadBytesResumable","getDownloadURL","jsxDEV","_jsxDEV","AddPost","_s","content","setContent","navigate","user","postimg","setpostimg","selectedFile","setSelectedFile","userId","id","_id","handleImageUpload","alert","storageRef","name","uploadTask","on","snapshot","console","log","bytesTransferred","totalBytes","error","downloadURL","err","_err$response","_err$response$data","response","data","message","handleFileChange","event","target","files","handleSubmit","e","preventDefault","postData","userName","post","_err$response2","maxWidth","sx","mt","children","elevation","p","borderRadius","variant","align","gutterBottom","fileName","_jsxFileName","lineNumber","columnNumber","component","onSubmit","display","flexDirection","gap","label","multiline","rows","value","onChange","required","color","type","_c","$RefreshReg$"],"sources":["/Users/manas_mm/Desktop/Uni-Sphere/client/src/components/AddPost.js"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\nimport { TextField, Button, Container, Typography, Paper, Box } from '@mui/material';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\nimport { useAuth } from '../auth/AuthContext'\nimport { getAuth } from \"firebase/auth\";\nimport { storage } from '../firebase';\nimport { ref, uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\n\n\nconst AddPost = () => {\n    const [content, setContent] = useState('');\n    const navigate = useNavigate();\n    const { user } = useAuth();  // Get user from context\n    const [postimg, setpostimg] =useState('');\n    const [selectedFile, setSelectedFile] = useState(null);  // State for image upload\n    const userId = id ? id : user?._id;\n    const { id } = useParams();\n\n\n    \n\n    const handleImageUpload = async () => {\n        if (!selectedFile) {\n            alert(\"Please select an image first!\");\n            return;\n        }\n\n        const storageRef = ref(storage, `postPictures/${userId}/${selectedFile.name}`);\n        const uploadTask = uploadBytesResumable(storageRef, selectedFile);\n\n        uploadTask.on(\n            \"state_changed\",\n            (snapshot) => {\n                console.log(`Upload progress: ${(snapshot.bytesTransferred / snapshot.totalBytes) * 100}%`);\n            },\n            (error) => {\n                console.error(\"Upload error:\", error);\n                alert(\"Upload failed. Check Firebase Storage permissions.\");\n            },\n            async () => {\n                // ✅ Get the download URL from Firebase Storage\n                const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\n                console.log(\"Downloaded URL:\", downloadURL);\n\n                // ✅ Update profileImage in MongoDB immediately after uploading\n                try {\n                    // const res = await axios.put(`http://localhost:5001/api/users/profile/${userId}`, {\n                    //     profileImage: downloadURL\n                    // });\n\n                    // setUserDetails(res.data.user); // Update UI state with new image URL\n                    setpostimg( downloadURL ); // Ensure form data is updated\n                    alert(\"Post picture updated successfully!\");\n\n                } catch (err) {\n                    console.error(\"Error updating profile picture:\", err.response?.data?.message || err.message);\n                }\n            }\n        );\n    };\n\n    const handleFileChange = (event) => {\n        setSelectedFile(event.target.files[0]);\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        try {\n            const postData = {\n                userId: user?._id,   // Safely accessing user data\n                userName: user?.name,\n                content\n            };\n\n            console.log('Post Data:', postData);  // Log the data before sending\n\n            // Send post data to backend\n            await axios.post('http://localhost:5001/api/posts/add', postData);\n            alert('Post created successfully!');\n            navigate('/home');  // Redirect to home after posting\n\n        } catch (err) {\n            console.error('Error creating post:', err.response?.data || err.message);  // More detailed error logging\n        }\n    };\n\n    return (\n        <Container maxWidth=\"sm\" sx={{ mt: 5 }}>\n            <Paper elevation={3} sx={{ p: 4, borderRadius: 3 }}>\n                <Typography variant=\"h4\" align=\"center\" gutterBottom>Create a New Post</Typography>\n                <Box component=\"form\" onSubmit={handleSubmit} sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\n                    <TextField\n                        label=\"What's on your mind?\"\n                        variant=\"outlined\"\n                        multiline\n                        rows={4}\n                        value={content}\n                        onChange={(e) => setContent(e.target.value)}\n                        required\n                    />\n                    <Button variant=\"contained\" color=\"primary\" type=\"submit\">Post</Button>\n                </Box>\n            </Paper>\n        </Container>\n    );\n};\n\nexport default AddPost;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}